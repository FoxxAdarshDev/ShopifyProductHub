{% comment %}
  Shopify Product Tab Template - Automatically detects and creates tabs from product description HTML

  This template analyzes the product description HTML content and:
  1. Detects tab content sections by their IDs
  2. Creates corresponding tab navigation
  3. Handles active/inactive tab states
  4. Provides responsive styling
{% endcomment %}

{% assign product_description = product.description %}

{% comment %} Check if product has our template structure {% endcomment %}
{% assign has_container = false %}
{% assign has_tab_structure = false %}
{% assign has_data_sku = false %}

{% if product_description contains 'class="container"' %}
  {% assign has_container = true %}
{% endif %}

{% if product_description contains 'id="description"' or product_description contains 'id="features"' or product_description contains 'id="applications"' %}
  {% assign has_tab_structure = true %}
{% endif %}

{% if product_description contains 'data-sku=' %}
  {% assign has_data_sku = true %}
{% endif %}

{% assign is_template_structure = false %}
{% if has_container and has_tab_structure and has_data_sku %}
  {% assign is_template_structure = true %}
{% endif %}

{% comment %} Only render tabs if we detect our template structure {% endcomment %}
{% if is_template_structure %}

<style>
/* Product Tab Styles */
.halo-product-tabs {
  margin: 20px 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

.halo-tab-navigation {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 0;
}

.halo-tab-button {
  background: none;
  border: none;
  padding: 12px 20px;
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  font-size: 14px;
  font-weight: 500;
  color: #6b7280;
  text-transform: capitalize;
  transition: all 0.2s ease;
  position: relative;
  border-bottom: 3px solid transparent;
}

.halo-tab-button:hover {
  color: #374151;
  background-color: #f9fafb;
}

.halo-tab-button.active {
  color: #1f2937;
  background-color: #ffffff;
  border-bottom-color: #3b82f6;
  font-weight: 600;
}

.halo-tab-content {
  display: block;
  margin-bottom: 40px;
  padding: 24px;
  border: 2px solid transparent;
  border-radius: 12px;
  transition: all 0.3s ease;
  scroll-margin-top: 100px;
}

.halo-tab-content.active {
  border-color: #3b82f6;
  background: #f8fafc;
  box-shadow: 0 4px 12px -2px rgba(59, 130, 246, 0.1);
}

.halo-tab-content-inner {
  line-height: 1.6;
}

.halo-tab-section-title {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e5e7eb;
  display: flex;
  align-items: center;
  gap: 12px;
}

.halo-tab-section-title:before {
  content: "";
  width: 4px;
  height: 28px;
  background: #3b82f6;
  border-radius: 2px;
}

/* Content Styling */
.halo-tab-content h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 16px;
  color: #1f2937;
}

.halo-tab-content h3 {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #374151;
}

.halo-tab-content h4 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 8px;
  color: #374151;
}

.halo-tab-content p {
  margin-bottom: 16px;
  color: #4b5563;
}

.halo-tab-content ul {
  margin-bottom: 16px;
  padding-left: 20px;
}

.halo-tab-content li {
  margin-bottom: 8px;
  color: #4b5563;
}

.halo-tab-content table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 16px;
}

.halo-tab-content table th,
.halo-tab-content table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #e5e7eb;
}

.halo-tab-content table th {
  background-color: #f9fafb;
  font-weight: 600;
  color: #374151;
}

.halo-tab-content .logo-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin: 20px 0;
}

.halo-tab-content .logo-grid img {
  max-height: 60px;
  width: auto;
}

/* Compatible Container Styling */
.compatible-items-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.compatible-item {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 20px;
  transition: all 0.3s ease;
  background: #ffffff;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.compatible-item:hover {
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  transform: translateY(-2px);
  border-color: #d1d5db;
}

.compatible-item img {
  width: 100%;
  height: 180px;
  object-fit: contain;
  object-position: center;
  border-radius: 8px;
  margin-bottom: 16px;
  background: #f9fafb;
  padding: 10px;
}

.compatible-item-content {
  min-height: 120px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.compatible-item-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #1f2937;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.compatible-item-description {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 16px;
  line-height: 1.5;
  flex-grow: 1;
}

.compatible-item-link {
  display: inline-flex;
  align-items: center;
  color: #2563eb;
  text-decoration: none;
  font-weight: 500;
  font-size: 14px;
  padding: 8px 16px;
  border: 1px solid #2563eb;
  border-radius: 6px;
  transition: all 0.2s ease;
  background: transparent;
  text-align: center;
  justify-content: center;
}

.compatible-item-link:hover {
  background: #2563eb;
  color: white;
  text-decoration: none;
  transform: translateY(-1px);
}

/* Documentation Links Styling */
.halo-tab-content #extracted-documentation {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.halo-tab-content #extracted-documentation .documentation-link-card {
  margin: 0;
}

.halo-tab-content #extracted-documentation .documentation-link-card a {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  text-decoration: none;
  transition: all 0.3s ease;
  background: #ffffff;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  color: #1f2937;
  font-weight: 500;
  min-height: 60px;
}

.halo-tab-content #extracted-documentation .documentation-link-card a:hover {
  box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
  transform: translateY(-1px);
  border-color: #d1d5db;
  background: #f8fafc;
}

.halo-tab-content #extracted-documentation .doc-icon {
  font-size: 20px;
  min-width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #eff6ff;
  border-radius: 8px;
  border: 1px solid #dbeafe;
  flex-shrink: 0;
}

.halo-tab-content #extracted-documentation .doc-icon.pdf-icon {
  background: #2563eb;
  color: white;
  border-color: #1d4ed8;
}

.halo-tab-content #extracted-documentation .doc-icon.datasheet-icon {
  background: #16a34a;
  color: white;
  border-color: #15803d;
}

.halo-tab-content #extracted-documentation .doc-icon.general-icon {
  background: #eff6ff;
  border-color: #dbeafe;
}

.halo-tab-content #extracted-documentation .doc-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
}

.halo-tab-content #extracted-documentation .doc-title {
  font-weight: 600;
  color: #1f2937;
  font-size: 16px;
  line-height: 1.3;
}

.halo-tab-content #extracted-documentation .doc-subtitle {
  font-weight: 400;
  color: #6b7280;
  font-size: 14px;
  line-height: 1.4;
}

/* Video responsive */
.halo-tab-content iframe {
  max-width: 100%;
  height: auto;
  aspect-ratio: 16/9;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .halo-tab-navigation {
    flex-direction: column;
    position: sticky;
    top: 0;
    background: white;
    z-index: 10;
    margin-bottom: 10px;
    padding: 10px 0;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .halo-tab-button {
    text-align: left;
    border-radius: 6px;
    border-bottom: none;
    border-left: 3px solid transparent;
    margin: 2px 8px;
  }

  .halo-tab-button.active {
    border-left-color: #3b82f6;
    border-bottom: none;
    background: #eff6ff;
  }

  .halo-tab-content {
    margin-bottom: 20px;
    padding: 16px;
    scroll-margin-top: 120px;
  }

  .halo-tab-section-title {
    font-size: 24px;
    margin-bottom: 16px;
  }

  .compatible-items-grid {
    grid-template-columns: 1fr;
  }

  .halo-tab-content iframe {
    width: 100%;
    height: 250px;
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* YouTube section styles */
.youtube-channel-section {
  padding: 16px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  background-color: #f9f9f9;
}

.youtube-brand-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.youtube-logo-container {
  display: flex;
  align-items: center;
}

.youtube-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 4px;
  background-color: #ff0000;
  color: #ffffff;
  font-size: 12px;
  margin-right: 8px;
}

.brand-name {
  font-weight: 500;
  color: #333;
}

.subscribe-button-container {
  /* Add any specific styling for the button container here */
}

.youtube-description {
  font-size: 14px;
  color: #555;
}
</style>

<div class="halo-product-tabs">
  {% comment %} Tabs will be detected and created dynamically by JavaScript {% endcomment %}

  {% comment %} Tab Navigation - Will be populated dynamically {% endcomment %}
  <div class="halo-tab-navigation">
    <!-- Dynamic tabs will be created here by JavaScript -->
  </div>

  {% comment %} Tab Content - Will be populated dynamically {% endcomment %}
  <div class="halo-tab-content-container">
    {% comment %} Hide original container and extract content directly {% endcomment %}
    <div style="display: none;" id="original-content">{{ product_description }}</div>
    <!-- Dynamic tab content will be created here by JavaScript -->
  </div>

    <script>
    function createDynamicTabs() {
      const originalContent = document.getElementById('original-content');
      if (!originalContent) return;

      const htmlContent = originalContent.innerHTML;

      // Create a temporary div to parse the HTML
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = htmlContent;

      // Find all tab-content divs with IDs and extract available tabs
      const tabElements = tempDiv.querySelectorAll('div[id]');
      const availableTabs = [];
      const tabTitles = {
        'description': 'Description',
        'features': 'Features', 
        'applications': 'Applications',
        'specification': 'Specifications',
        'sterilization-method': 'Sterilization Method',
        'compatible-container': 'Compatible Container',
        'documentation': 'Documentation',
        'videos': 'Videos'
      };

      // Check which tabs actually have content
      tabElements.forEach(function(element) {
        const tabId = element.id;
        if (tabTitles[tabId] && element.innerHTML.trim()) {
          availableTabs.push(tabId);
        }
      });

      // Dynamically create tab navigation
      const tabNavigation = document.querySelector('.halo-tab-navigation');
      if (tabNavigation && availableTabs.length > 0) {
        tabNavigation.innerHTML = '';

        availableTabs.forEach(function(tabId, index) {
          const button = document.createElement('button');
          button.className = 'halo-tab-button' + (index === 0 ? ' active' : '');
          button.setAttribute('onclick', `haloSwitchTab(event, '${tabId}')`);
          button.setAttribute('data-tab', tabId);
          button.textContent = tabTitles[tabId];
          tabNavigation.appendChild(button);
        });
      }

      // Dynamically create tab content containers
      const tabContainer = document.querySelector('.halo-tab-content-container');
      if (tabContainer && availableTabs.length > 0) {
        tabContainer.innerHTML = '<div style="display: none;" id="original-content">' + originalContent.innerHTML + '</div>';

        availableTabs.forEach(function(tabId, index) {
          const tabDiv = document.createElement('div');
          tabDiv.id = 'halo-' + tabId;
          tabDiv.className = 'halo-tab-content' + (index === 0 ? ' active' : '');

          const innerDiv = document.createElement('div');
          innerDiv.className = 'halo-tab-content-inner';

          // Add section title
          const titleDiv = document.createElement('h2');
          titleDiv.className = 'halo-tab-section-title';
          titleDiv.textContent = tabTitles[tabId];

          const extractedDiv = document.createElement('div');
          extractedDiv.id = 'extracted-' + tabId;

          innerDiv.appendChild(titleDiv);
          innerDiv.appendChild(extractedDiv);
          tabDiv.appendChild(innerDiv);
          tabContainer.appendChild(tabDiv);
        });
      }

      // Clean up
      tempDiv.remove();
    }

    function extractTabContent() {
      const originalContent = document.getElementById('original-content');
      if (!originalContent) return;

      const htmlContent = originalContent.innerHTML;

      // Create a temporary div to parse the HTML
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = htmlContent;

      // Find all tab-content divs with IDs
      const tabElements = tempDiv.querySelectorAll('div[id]');

      tabElements.forEach(function(element) {
        const tabId = element.id;
        const extractedElement = document.getElementById('extracted-' + tabId);

        if (extractedElement) {
          // Clone the inner content without the wrapper div
          const content = element.innerHTML;
          extractedElement.innerHTML = content;
        }
      });

      // Clean up
      tempDiv.remove();
    }

    function haloSwitchTab(event, tabId) {
      // Remove active class from all tab buttons
      var tabButtons = document.querySelectorAll('.halo-tab-button');
      tabButtons.forEach(function(button) {
        button.classList.remove('active');
      });

      // Add active class to clicked button
      event.target.classList.add('active');

      // Remove active class from all tab content
      var tabContents = document.querySelectorAll('.halo-tab-content');
      tabContents.forEach(function(content) {
        content.classList.remove('active');
      });

      // Find and scroll to the selected tab content
      var activeTab = document.getElementById('halo-' + tabId);
      if (activeTab) {
        // Add active class for highlighting
        activeTab.classList.add('active');

        // Smooth scroll to the section
        activeTab.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start',
          inline: 'nearest' 
        });
      }
    }

    // Add scroll spy functionality to highlight active section
    function setupScrollSpy() {
      const tabContents = document.querySelectorAll('.halo-tab-content');
      const tabButtons = document.querySelectorAll('.halo-tab-button');

      if (tabContents.length === 0 || tabButtons.length === 0) return;

      const observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
            const tabId = entry.target.id.replace('halo-', '');

            // Remove active from all buttons and content
            tabButtons.forEach(function(btn) { btn.classList.remove('active'); });
            tabContents.forEach(function(content) { content.classList.remove('active'); });

            // Add active to current section and button
            entry.target.classList.add('active');
            const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeButton) {
              activeButton.classList.add('active');
            }
          }
        });
      }, { 
        threshold: [0.5],
        rootMargin: '-20% 0px -20% 0px'
      });

      tabContents.forEach(function(content) {
        observer.observe(content);
      });
    }

    // Initialize tabs on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Create dynamic tabs first
      createDynamicTabs();

      // Then extract content
      extractTabContent();

      // Setup scroll spy to highlight active sections
      setTimeout(function() {
        setupScrollSpy();

        // Ensure first tab is active by default
        var firstButton = document.querySelector('.halo-tab-button');
        var firstContent = document.querySelector('.halo-tab-content');

        if (firstButton && firstContent) {
          firstButton.classList.add('active');
          firstContent.classList.add('active');
        }
      }, 100);
    });
    </script>

</div>

<!-- YouTube API Script - Load once globally -->
<script src="https://apis.google.com/js/platform.js"></script>
<!-- Include the external script -->
<script src="//www.foxxlifesciences.com/cdn/shop/t/37/assets/modalFunctions.js"></script>

{% else %}
  {% comment %} Fallback: Show original product description if no template structure detected {% endcomment %}
  <div class="product-description-fallback">
    {{ product.description }}
  </div>
{% endif %}