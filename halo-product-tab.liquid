{% comment %}
  Halo Product Tab Template - Scroll Navigation Version
  Shows all content visible with scroll-to-section navigation
  Based on your existing website pattern
{% endcomment %}

{% comment %} Get the product description {% endcomment %}
{% assign product_description = product.description %}

{% comment %} Check if this product has our template structure {% endcomment %}
{% if product_description contains 'class="container"' and product_description contains 'data-sku=' %}

  {% comment %} Dynamic tab detection - only check for tabs that actually exist in the HTML {% endcomment %}
  {% assign available_tabs = '' %}
  {% assign available_titles = '' %}
  
  {% comment %} Check each possible tab and only add it if it exists {% endcomment %}
  {% if product_description contains 'id="halo-description"' %}
    {% assign available_tabs = 'description' %}
    {% assign available_titles = 'Description' %}
  {% endif %}
  
  {% if product_description contains 'id="halo-features"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'features' %}
      {% assign available_titles = 'Features' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',features' %}
      {% assign available_titles = available_titles | append: ',Features' %}
    {% endif %}
  {% endif %}
  
  {% if product_description contains 'id="halo-applications"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'applications' %}
      {% assign available_titles = 'Applications' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',applications' %}
      {% assign available_titles = available_titles | append: ',Applications' %}
    {% endif %}
  {% endif %}
  
  {% if product_description contains 'id="halo-specification"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'specification' %}
      {% assign available_titles = 'Specifications' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',specification' %}
      {% assign available_titles = available_titles | append: ',Specifications' %}
    {% endif %}
  {% endif %}
  
  {% if product_description contains 'id="halo-sterilization-method"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'sterilization-method' %}
      {% assign available_titles = 'Sterilization Method' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',sterilization-method' %}
      {% assign available_titles = available_titles | append: ',Sterilization Method' %}
    {% endif %}
  {% endif %}
  
  {% if product_description contains 'id="halo-compatible-container"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'compatible-container' %}
      {% assign available_titles = 'Compatible Container' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',compatible-container' %}
      {% assign available_titles = available_titles | append: ',Compatible Container' %}
    {% endif %}
  {% endif %}
  
  {% if product_description contains 'id="halo-documentation"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'documentation' %}
      {% assign available_titles = 'Documentation' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',documentation' %}
      {% assign available_titles = available_titles | append: ',Documentation' %}
    {% endif %}
  {% endif %}
  
  {% if product_description contains 'id="halo-videos"' %}
    {% if available_tabs == '' %}
      {% assign available_tabs = 'videos' %}
      {% assign available_titles = 'Videos' %}
    {% else %}
      {% assign available_tabs = available_tabs | append: ',videos' %}
      {% assign available_titles = available_titles | append: ',Videos' %}
    {% endif %}
  {% endif %}

  {% comment %} Only proceed if we found at least one tab {% endcomment %}
  {% if available_tabs != '' %}
    {% assign tab_array = available_tabs | split: ',' %}
    {% assign title_array = available_titles | split: ',' %}

    <div class="halo-product-container">
      <style>
        .halo-product-container {
          max-width: 1200px;
          margin: 0 auto;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .halo-tabs {
          display: flex !important;
          border-bottom: 1px solid #e2e8f0 !important;
          margin-bottom: 32px !important;
          overflow-x: auto;
          scrollbar-width: none;
          -ms-overflow-style: none;
          position: sticky;
          top: 0;
          background: white !important;
          z-index: 100;
          padding: 8px 0 !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
        
        .halo-tabs::-webkit-scrollbar {
          display: none;
        }
        
        .halo-tab {
          background: none !important;
          border: none !important;
          padding: 16px 24px !important;
          cursor: pointer !important;
          font-size: 14px !important;
          font-weight: 500 !important;
          color: #64748b !important;
          white-space: nowrap !important;
          border-bottom: 2px solid transparent !important;
          transition: all 0.2s ease !important;
          min-width: fit-content !important;
          text-decoration: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
        
        .halo-tab:hover {
          color: #1e293b !important;
          background-color: #f8fafc !important;
        }
        
        .halo-tab.active {
          color: #2563eb !important;
          border-bottom-color: #2563eb !important;
          background-color: #eff6ff !important;
        }
        
        .halo-tab-content {
          margin-bottom: 48px;
          scroll-margin-top: 120px;
          display: block !important;
          visibility: visible !important;
        }
        
        .halo-tab-header {
          font-size: 24px;
          font-weight: 600;
          color: #000000;
          margin-bottom: 24px;
          padding-bottom: 12px;
          border-bottom: 2px solid #e2e8f0;
        }
        
        .halo-tab-header.inactive {
          font-size: 18px;
          color: #808080;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
          .halo-tab {
            padding: 12px 16px;
            font-size: 13px;
          }
          
          .halo-tabs {
            margin-bottom: 24px;
          }
          
          .halo-tab-header {
            font-size: 20px;
          }
          
          .halo-tab-header.inactive {
            font-size: 16px;
          }
        }
        
        /* Content styling */
        .halo-tab-content h2,
        .halo-tab-content h3,
        .halo-tab-content h4 {
          margin-top: 0;
          margin-bottom: 16px;
          color: #1e293b;
        }
        
        .halo-tab-content p {
          margin-bottom: 16px;
          line-height: 1.6;
          color: #374151;
        }
        
        .halo-tab-content ul {
          margin: 16px 0;
          padding-left: 20px;
        }
        
        .halo-tab-content li {
          margin-bottom: 8px;
          line-height: 1.6;
          color: #374151;
        }
        
        .halo-tab-content table {
          width: 100%;
          border-collapse: collapse;
          margin: 16px 0;
        }
        
        .halo-tab-content table td {
          padding: 12px;
          border: 1px solid #e5e7eb;
          vertical-align: top;
        }
        
        .halo-tab-content table tr:first-child td {
          background-color: #f9fafb;
          font-weight: 600;
        }
        
        .logo-grid {
          display: flex;
          gap: 16px;
          margin: 24px 0;
          flex-wrap: wrap;
        }
        
        .logo-grid img {
          max-height: 60px;
          width: auto;
        }
        
        .compatible-items-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 24px;
          margin: 24px 0;
        }
        
        .compatible-item {
          border: 1px solid #e5e7eb;
          border-radius: 8px;
          padding: 16px;
          transition: box-shadow 0.2s ease;
        }
        
        .compatible-item:hover {
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .compatible-item img {
          width: 100%;
          height: 200px;
          object-fit: cover;
          border-radius: 4px;
          margin-bottom: 12px;
        }
        
        .compatible-item-title {
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 8px;
          color: #1e293b;
        }
        
        .compatible-item-description {
          font-size: 14px;
          color: #6b7280;
          margin-bottom: 12px;
        }
        
        .compatible-item-link {
          display: inline-block;
          color: #2563eb;
          text-decoration: none;
          font-weight: 500;
          font-size: 14px;
        }
        
        .compatible-item-link:hover {
          text-decoration: underline;
        }

        /* Override any existing hide/show styles */
        .halo-tab-content,
        .halo-tab-content.active,
        .halo-tab-content.inactive {
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }

        /* Remove any conflicting fadeIn animation */
        .halo-tab-content {
          animation: none !important;
        }

        /* Force tab navigation to be visible - debug styles */
        .halo-product-container .halo-tabs {
          border: 2px solid red !important; /* Temporary debug border */
          min-height: 60px !important;
          width: 100% !important;
        }

        .halo-product-container .halo-tab {
          border: 1px solid blue !important; /* Temporary debug border */
          margin: 2px !important;
          background-color: #f0f0f0 !important;
        }
      </style>

      {% comment %} Tab Navigation {% endcomment %}
      <div class="halo-tabs">
        {% for tab in tab_array %}
          {% assign tab_index = forloop.index0 %}
          {% assign tab_title = title_array[tab_index] %}
          {% assign is_first = forloop.first %}
          <div 
            class="halo-tab{% if is_first %} active{% endif %}" 
            onclick="haloOpenTab('{{ tab }}', this)"
            data-tab="{{ tab }}">
            {{ tab_title }}
          </div>
        {% endfor %}
      </div>

      {% comment %} All Tab Content - Visible by default {% endcomment %}
      {% for tab in tab_array %}
        {% assign tab_index = forloop.index0 %}
        {% assign tab_title = title_array[tab_index] %}
        {% assign is_first = forloop.first %}
        
        <div id="{{ tab }}" class="halo-tab-content">
          {% comment %} Add header for non-description tabs {% endcomment %}
          {% unless tab == 'description' %}
            <div class="halo-tab-header{% unless is_first %} inactive{% endunless %}">
              <strong>{{ tab_title }}</strong>
            </div>
          {% endunless %}
          
          <div class="halo-tab-content-inner">
            {% comment %} Extract content from halo-prefixed IDs {% endcomment %}
            {% assign halo_tab_id = 'halo-' | append: tab %}
            {% assign tab_start_marker = 'id="' | append: halo_tab_id | append: '"' %}
            {% assign content_split = product_description | split: tab_start_marker %}
            
            {% if content_split.size > 1 %}
              {% comment %} Find the content inside the halo-tab-content-inner div {% endcomment %}
              {% assign after_id = content_split[1] %}
              {% assign inner_content_start = after_id | split: '<div class="halo-tab-content-inner">' %}
              
              {% if inner_content_start.size > 1 %}
                {% assign inner_content = inner_content_start[1] %}
                
                {% comment %} Find the end of this tab's content - look for the closing div structure {% endcomment %}
                {% assign content_end = inner_content | split: '</div>' %}
                {% assign content_end_2 = content_end[1] | split: '</div>' %}
                {% assign final_content = content_end[0] %}
                
                {{ final_content | strip }}
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% endfor %}

      {% comment %} JavaScript for scroll navigation {% endcomment %}
      <script>
        function haloOpenTab(tabName, elem, shouldScroll = true) {
          // Update tab styles
          var tablinks = document.getElementsByClassName("halo-tab");
          for (var i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
          }
          elem.classList.add("active");

          // Update header styles
          var headers = document.querySelectorAll(".halo-tab-header");
          headers.forEach(function(header) {
            var content = header.closest('.halo-tab-content');
            if (content && content.id === tabName) {
              header.style.color = "#000000";
              header.style.fontSize = "24px";
              header.classList.remove("inactive");
            } else {
              header.style.color = "#808080";
              header.style.fontSize = "18px";
              header.classList.add("inactive");
            }
          });

          // Scroll to content
          var selectedTabContent = document.getElementById(tabName);
          if (selectedTabContent && shouldScroll) {
            selectedTabContent.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        }

        // Handle click events
        document.addEventListener("click", function(event) {
          if (event.target.classList.contains("halo-tab")) {
            var tabName = event.target.getAttribute("data-tab");
            haloOpenTab(tabName, event.target, true);
          }
        });

        // Initialize on page load
        document.addEventListener("DOMContentLoaded", function() {
          // Set first tab as active
          var firstTab = document.querySelector(".halo-tab");
          if (firstTab) {
            firstTab.classList.add("active");
            haloOpenTab(firstTab.getAttribute("data-tab"), firstTab, false);
          }
        });
      </script>
    </div>

  {% else %}
    {% comment %} Fallback for products without template structure {% endcomment %}
    <div class="halo-product-description-fallback">
      {{ product.description }}
    </div>
  {% endif %}

{% else %}
  {% comment %} Fallback for products without template structure {% endcomment %}
  <div class="halo-product-description-fallback">
    {{ product.description }}
  </div>
{% endif %}