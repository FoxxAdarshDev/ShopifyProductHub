{% comment %}
  Shopify Product Tab Template - Automatically detects and creates tabs from product description HTML
  
  This template analyzes the product description HTML content and:
  1. Detects tab content sections by their IDs
  2. Creates corresponding tab navigation
  3. Handles active/inactive tab states
  4. Provides responsive styling
{% endcomment %}

{% assign product_description = product.description %}

{% comment %} Check if product has our template structure {% endcomment %}
{% assign has_container = false %}
{% assign has_tab_structure = false %}
{% assign has_data_sku = false %}

{% if product_description contains 'class="container"' %}
  {% assign has_container = true %}
{% endif %}

{% if product_description contains 'id="description"' or product_description contains 'id="features"' or product_description contains 'id="applications"' %}
  {% assign has_tab_structure = true %}
{% endif %}

{% if product_description contains 'data-sku=' %}
  {% assign has_data_sku = true %}
{% endif %}

{% assign is_template_structure = false %}
{% if has_container and has_tab_structure and has_data_sku %}
  {% assign is_template_structure = true %}
{% endif %}

{% comment %} Only render tabs if we detect our template structure {% endcomment %}
{% if is_template_structure %}

<style>
/* Product Tab Styles */
.halo-product-tabs {
  margin: 20px 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

.halo-tab-navigation {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 0;
}

.halo-tab-button {
  background: none;
  border: none;
  padding: 12px 20px;
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  font-size: 14px;
  font-weight: 500;
  color: #6b7280;
  text-transform: capitalize;
  transition: all 0.2s ease;
  position: relative;
  border-bottom: 3px solid transparent;
}

.halo-tab-button:hover {
  color: #374151;
  background-color: #f9fafb;
}

.halo-tab-button.active {
  color: #1f2937;
  background-color: #ffffff;
  border-bottom-color: #3b82f6;
  font-weight: 600;
}

.halo-tab-content {
  display: none;
  animation: fadeIn 0.3s ease-in-out;
}

.halo-tab-content.active {
  display: block;
}

.halo-tab-content-inner {
  padding: 20px 0;
  line-height: 1.6;
}

/* Content Styling */
.halo-tab-content h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 16px;
  color: #1f2937;
}

.halo-tab-content h3 {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #374151;
}

.halo-tab-content h4 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 8px;
  color: #374151;
}

.halo-tab-content p {
  margin-bottom: 16px;
  color: #4b5563;
}

.halo-tab-content ul {
  margin-bottom: 16px;
  padding-left: 20px;
}

.halo-tab-content li {
  margin-bottom: 8px;
  color: #4b5563;
}

.halo-tab-content table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 16px;
}

.halo-tab-content table th,
.halo-tab-content table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #e5e7eb;
}

.halo-tab-content table th {
  background-color: #f9fafb;
  font-weight: 600;
  color: #374151;
}

.halo-tab-content .logo-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin: 20px 0;
}

.halo-tab-content .logo-grid img {
  max-height: 60px;
  width: auto;
}

/* Compatible Container Styling */
.compatible-items-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.compatible-item {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 16px;
  transition: shadow 0.2s ease;
}

.compatible-item:hover {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.compatible-item img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 6px;
  margin-bottom: 12px;
}

.compatible-item-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 8px;
  color: #1f2937;
}

.compatible-item-description {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 12px;
}

.compatible-item-link {
  display: inline-block;
  color: #3b82f6;
  text-decoration: none;
  font-weight: 500;
  font-size: 14px;
}

.compatible-item-link:hover {
  text-decoration: underline;
}

/* Video responsive */
.halo-tab-content iframe {
  max-width: 100%;
  height: auto;
  aspect-ratio: 16/9;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .halo-tab-navigation {
    flex-direction: column;
  }
  
  .halo-tab-button {
    text-align: left;
    border-radius: 6px;
    border-bottom: none;
    border-left: 3px solid transparent;
  }
  
  .halo-tab-button.active {
    border-left-color: #3b82f6;
    border-bottom: none;
  }
  
  .compatible-items-grid {
    grid-template-columns: 1fr;
  }
  
  .halo-tab-content iframe {
    width: 100%;
    height: 250px;
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<div class="halo-product-tabs">
  {% comment %} Detect available tabs from the HTML content {% endcomment %}
  {% assign available_tabs = '' %}
  {% assign tab_titles = '' %}
  
  {% comment %} Define tab order and titles {% endcomment %}
  {% assign ordered_tabs = 'description,features,applications,specification,sterilization-method,compatible-container,documentation,videos' | split: ',' %}
  {% assign tab_display_names = 'Description,Features,Applications,Specifications,Sterilization Method,Compatible Container,Documentation,Videos' | split: ',' %}
  
  {% comment %} Check which tabs are present in the content {% endcomment %}
  {% assign found_tabs = '' %}
  {% assign found_titles = '' %}
  
  {% comment %} Check for description {% endcomment %}
  {% if product_description contains 'id="description"' %}
    {% assign found_tabs = 'description' %}
    {% assign found_titles = 'Description' %}
  {% endif %}
  
  {% comment %} Check for features {% endcomment %}
  {% if product_description contains 'id="features"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'features' %}
      {% assign found_titles = 'Features' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',features' %}
      {% assign found_titles = found_titles | append: ',Features' %}
    {% endif %}
  {% endif %}
  
  {% comment %} Check for applications {% endcomment %}
  {% if product_description contains 'id="applications"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'applications' %}
      {% assign found_titles = 'Applications' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',applications' %}
      {% assign found_titles = found_titles | append: ',Applications' %}
    {% endif %}
  {% endif %}
  
  {% comment %} Check for specification {% endcomment %}
  {% if product_description contains 'id="specification"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'specification' %}
      {% assign found_titles = 'Specifications' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',specification' %}
      {% assign found_titles = found_titles | append: ',Specifications' %}
    {% endif %}
  {% endif %}
  
  {% comment %} Check for sterilization-method {% endcomment %}
  {% if product_description contains 'id="sterilization-method"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'sterilization-method' %}
      {% assign found_titles = 'Sterilization Method' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',sterilization-method' %}
      {% assign found_titles = found_titles | append: ',Sterilization Method' %}
    {% endif %}
  {% endif %}
  
  {% comment %} Check for compatible-container {% endcomment %}
  {% if product_description contains 'id="compatible-container"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'compatible-container' %}
      {% assign found_titles = 'Compatible Container' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',compatible-container' %}
      {% assign found_titles = found_titles | append: ',Compatible Container' %}
    {% endif %}
  {% endif %}
  
  {% comment %} Check for documentation {% endcomment %}
  {% if product_description contains 'id="documentation"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'documentation' %}
      {% assign found_titles = 'Documentation' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',documentation' %}
      {% assign found_titles = found_titles | append: ',Documentation' %}
    {% endif %}
  {% endif %}
  
  {% comment %} Check for videos {% endcomment %}
  {% if product_description contains 'id="videos"' %}
    {% if found_tabs == '' %}
      {% assign found_tabs = 'videos' %}
      {% assign found_titles = 'Videos' %}
    {% else %}
      {% assign found_tabs = found_tabs | append: ',videos' %}
      {% assign found_titles = found_titles | append: ',Videos' %}
    {% endif %}
  {% endif %}
  
  {% assign available_tabs = found_tabs | split: ',' %}
  {% assign tab_titles = found_titles | split: ',' %}
  
  {% comment %} Only show tabs if we found any {% endcomment %}
  {% if available_tabs.size > 0 %}
    
    {% comment %} Tab Navigation {% endcomment %}
    <div class="halo-tab-navigation">
      {% for tab in available_tabs %}
        {% assign tab_title = tab_titles[forloop.index0] %}
        {% assign is_first = forloop.first %}
        <button class="halo-tab-button{% if is_first %} active{% endif %}" 
                onclick="haloSwitchTab(event, '{{ tab }}')" 
                data-tab="{{ tab }}">
          {{ tab_title }}
        </button>
      {% endfor %}
    </div>
    
    {% comment %} Tab Content {% endcomment %}
    <div class="halo-tab-content-container">
      {% for tab in available_tabs %}
        {% assign is_first = forloop.first %}
        <div id="halo-{{ tab }}" class="halo-tab-content{% if is_first %} active{% endif %}">
          <div class="halo-tab-content-inner">
            {% comment %} Extract and display the specific tab content {% endcomment %}
            {% if tab == 'description' %}
              {% comment %} Find description content between opening and closing div tags {% endcomment %}
              {% assign desc_start = product_description | split: 'id="description"' %}
              {% if desc_start.size > 1 %}
                {% assign desc_after_id = desc_start[1] %}
                {% assign desc_after_opening = desc_after_id | split: '>' %}
                {% if desc_after_opening.size > 1 %}
                  {% assign desc_content_raw = desc_after_opening[1] %}
                  {% assign desc_end_split = desc_content_raw | split: '</div>' %}
                  {% assign desc_final_content = desc_end_split[0] %}
                  {{ desc_final_content }}
                {% endif %}
              {% endif %}
            {% elsif tab == 'features' %}
              {% comment %} Find features content between opening and closing div tags {% endcomment %}
              {% assign feat_start = product_description | split: 'id="features"' %}
              {% if feat_start.size > 1 %}
                {% assign feat_after_id = feat_start[1] %}
                {% assign feat_after_opening = feat_after_id | split: '>' %}
                {% if feat_after_opening.size > 1 %}
                  {% assign feat_content_raw = feat_after_opening[1] %}
                  {% assign feat_end_split = feat_content_raw | split: '</div>' %}
                  {% assign feat_final_content = feat_end_split[0] %}
                  {{ feat_final_content }}
                {% endif %}
              {% endif %}
            {% elsif tab == 'applications' %}
              {% comment %} Find applications content between opening and closing div tags {% endcomment %}
              {% assign app_start = product_description | split: 'id="applications"' %}
              {% if app_start.size > 1 %}
                {% assign app_after_id = app_start[1] %}
                {% assign app_after_opening = app_after_id | split: '>' %}
                {% if app_after_opening.size > 1 %}
                  {% assign app_content_raw = app_after_opening[1] %}
                  {% assign app_end_split = app_content_raw | split: '</div>' %}
                  {% assign app_final_content = app_end_split[0] %}
                  {{ app_final_content }}
                {% endif %}
              {% endif %}
            {% elsif tab == 'specification' %}
              {% comment %} Find specification content between opening and closing div tags {% endcomment %}
              {% assign spec_start = product_description | split: 'id="specification"' %}
              {% if spec_start.size > 1 %}
                {% assign spec_after_id = spec_start[1] %}
                {% assign spec_after_opening = spec_after_id | split: '>' %}
                {% if spec_after_opening.size > 1 %}
                  {% assign spec_content_raw = spec_after_opening[1] %}
                  {% assign spec_end_split = spec_content_raw | split: '</div>' %}
                  {% assign spec_final_content = spec_end_split[0] %}
                  {{ spec_final_content }}
                {% endif %}
              {% endif %}
            {% elsif tab == 'sterilization-method' %}
              {% comment %} Find sterilization-method content between opening and closing div tags {% endcomment %}
              {% assign ster_start = product_description | split: 'id="sterilization-method"' %}
              {% if ster_start.size > 1 %}
                {% assign ster_after_id = ster_start[1] %}
                {% assign ster_after_opening = ster_after_id | split: '>' %}
                {% if ster_after_opening.size > 1 %}
                  {% assign ster_content_raw = ster_after_opening[1] %}
                  {% assign ster_end_split = ster_content_raw | split: '</div>' %}
                  {% assign ster_final_content = ster_end_split[0] %}
                  {{ ster_final_content }}
                {% endif %}
              {% endif %}
            {% elsif tab == 'compatible-container' %}
              {% comment %} Find compatible-container content - this has nested divs so we need special handling {% endcomment %}
              {% assign comp_start = product_description | split: 'id="compatible-container"' %}
              {% if comp_start.size > 1 %}
                {% assign comp_after_id = comp_start[1] %}
                {% assign comp_after_opening = comp_after_id | split: '>' %}
                {% if comp_after_opening.size > 1 %}
                  {% assign comp_content_with_nested = comp_after_opening[1] %}
                  {% comment %} For compatible container, we need to find the end of the entire section {% endcomment %}
                  {% assign comp_end_marker = comp_content_with_nested | split: '<div class="tab-content" id="sterilization-method"' %}
                  {% if comp_end_marker.size > 1 %}
                    {% assign comp_final_content = comp_end_marker[0] %}
                    {% comment %} Remove trailing closing div tags {% endcomment %}
                    {% assign comp_clean = comp_final_content | split: '</div>' %}
                    {% assign comp_output = '' %}
                    {% for comp_part in comp_clean %}
                      {% unless forloop.last %}
                        {% if comp_output == '' %}
                          {% assign comp_output = comp_part %}
                        {% else %}
                          {% assign comp_output = comp_output | append: '</div>' | append: comp_part %}
                        {% endif %}
                      {% endunless %}
                    {% endfor %}
                    {{ comp_output }}
                  {% endif %}
                {% endif %}
              {% endif %}
            {% elsif tab == 'documentation' %}
              {% comment %} Find documentation content between opening and closing div tags {% endcomment %}
              {% assign doc_start = product_description | split: 'id="documentation"' %}
              {% if doc_start.size > 1 %}
                {% assign doc_after_id = doc_start[1] %}
                {% assign doc_after_opening = doc_after_id | split: '>' %}
                {% if doc_after_opening.size > 1 %}
                  {% assign doc_content_raw = doc_after_opening[1] %}
                  {% assign doc_end_split = doc_content_raw | split: '</div>' %}
                  {% assign doc_final_content = doc_end_split[0] %}
                  {{ doc_final_content }}
                {% endif %}
              {% endif %}
            {% elsif tab == 'videos' %}
              {% comment %} Find videos content between opening and closing div tags {% endcomment %}
              {% assign vid_start = product_description | split: 'id="videos"' %}
              {% if vid_start.size > 1 %}
                {% assign vid_after_id = vid_start[1] %}
                {% assign vid_after_opening = vid_after_id | split: '>' %}
                {% if vid_after_opening.size > 1 %}
                  {% assign vid_content_raw = vid_after_opening[1] %}
                  {% assign vid_end_split = vid_content_raw | split: '</div>' %}
                  {% assign vid_final_content = vid_end_split[0] %}
                  {{ vid_final_content }}
                {% endif %}
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    
    <script>
    function haloSwitchTab(event, tabId) {
      // Remove active class from all tab buttons
      var tabButtons = document.querySelectorAll('.halo-tab-button');
      tabButtons.forEach(function(button) {
        button.classList.remove('active');
      });
      
      // Add active class to clicked button
      event.target.classList.add('active');
      
      // Hide all tab content
      var tabContents = document.querySelectorAll('.halo-tab-content');
      tabContents.forEach(function(content) {
        content.classList.remove('active');
      });
      
      // Show selected tab content
      var activeTab = document.getElementById('halo-' + tabId);
      if (activeTab) {
        activeTab.classList.add('active');
      }
    }
    
    // Initialize tabs on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Ensure first tab is active by default
      var firstButton = document.querySelector('.halo-tab-button');
      var firstContent = document.querySelector('.halo-tab-content');
      
      if (firstButton && firstContent) {
        firstButton.classList.add('active');
        firstContent.classList.add('active');
      }
    });
    </script>
    
  {% endif %}
  
{% else %}
  {% comment %} Fallback: Show original product description if no template structure detected {% endcomment %}
  <div class="product-description-fallback">
    {{ product.description }}
  </div>
{% endif %}

</div>