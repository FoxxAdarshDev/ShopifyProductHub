<!-- Halo Product Tab Template - Improved Version -->
<!-- Place this file as a snippet in your Shopify theme: snippets/halo-product-tab-improved.liquid -->

<style>
/* Enhanced Tab Navigation Styles */
.halo-tab-nav {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  padding: 10px 0;
  border-bottom: 2px solid #e5e7eb;
}

.halo-tab-button {
  padding: 12px 20px !important;
  border: 2px solid #d1d5db !important;
  background: #f9fafb !important;
  border-radius: 8px !important;
  cursor: pointer !important;
  transition: all 0.3s ease !important;
  font-size: 16px !important; /* Fixed: Increased tab text size */
  font-weight: 600 !important;
  color: #374151 !important;
  text-decoration: none !important;
  display: inline-block !important;
  line-height: 1.2 !important;
  min-height: 44px !important; /* Better touch target */
}

.halo-tab-button:hover {
  background: #e5e7eb !important;
  border-color: #9ca3af !important;
  color: #1f2937 !important;
  text-decoration: none !important;
}

.halo-tab-button.active {
  background: #2563eb !important;
  border-color: #2563eb !important;
  color: white !important;
  box-shadow: 0 4px 6px rgba(37, 99, 235, 0.25) !important;
}

/* Content Container Styles */
.halo-tab-content-container {
  min-height: 300px;
  background: #ffffff;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
}

.halo-tab-content {
  display: none;
  animation: fadeIn 0.3s ease-in-out;
}

.halo-tab-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Enhanced Logo Grid Styles - Fixed Issues */
.logo-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
  gap: 16px !important;
  margin: 24px 0 !important;
  padding: 20px !important;
  background: #f8f9fa !important;
  border-radius: 8px !important;
  border: 2px solid #e5e7eb !important; /* Fixed: Added border */
}

.logo-grid img {
  width: 100% !important;
  height: 60px !important;
  object-fit: contain !important;
  background: white !important;
  border: 1px solid #d1d5db !important; /* Fixed: Added individual image borders */
  border-radius: 6px !important;
  padding: 8px !important; /* Fixed: Added padding */
  display: block !important;
  margin: 0 auto !important; /* Fixed: Center images */
  transition: transform 0.2s ease !important;
}

.logo-grid img:hover {
  transform: scale(1.05) !important;
  border-color: #2563eb !important;
}

/* Enhanced Videos Section - Fixed Full Width Issue */
#videos {
  width: 100% !important;
}

#videos iframe {
  width: 100% !important; /* Fixed: Full width video */
  max-width: 100% !important;
  height: 315px !important;
  border-radius: 12px !important;
  margin-bottom: 24px !important;
  display: block !important;
}

/* YouTube Channel Section - Fixed Subscriber Button Visibility */
.youtube-channel-section {
  margin-top: 32px !important;
  padding: 24px !important;
  background: #f8f9fa !important;
  border-radius: 12px !important;
  border: 1px solid #e5e7eb !important;
  width: 100% !important;
}

.youtube-brand-header {
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  margin-bottom: 16px !important;
  flex-wrap: wrap !important;
  gap: 16px !important;
}

.youtube-logo-container {
  display: flex !important;
  align-items: center !important;
  gap: 12px !important;
}

.youtube-icon {
  width: 48px !important;
  height: 48px !important;
  background: #ff0000 !important;
  border-radius: 12px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  color: white !important;
  font-size: 24px !important;
  font-weight: bold !important;
}

.brand-name {
  font-size: 18px !important;
  font-weight: 600 !important;
  color: #1f2937 !important;
}

/* Fixed: Subscribe Button Container - Made Visible */
.subscribe-button-container {
  display: block !important; /* Fixed: Was hidden */
  visibility: visible !important; /* Fixed: Ensure visibility */
  opacity: 1 !important; /* Fixed: Ensure opacity */
  min-height: 40px !important;
  min-width: 120px !important;
}

.g-ytsubscribe {
  display: block !important; /* Fixed: Make subscribe button visible */
  visibility: visible !important;
  opacity: 1 !important;
  z-index: 1000 !important;
}

.youtube-description {
  font-size: 16px !important;
  color: #6b7280 !important;
  line-height: 1.6 !important;
  margin: 0 !important;
}

.youtube-description a {
  color: #2563eb !important;
  text-decoration: none !important;
  font-weight: 600 !important;
}

.youtube-description a:hover {
  text-decoration: underline !important;
}

/* Documentation Link Cards - Enhanced */
.documentation-link-card {
  margin: 16px 0 !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  border: 1px solid #e5e7eb !important;
  background: white !important;
  transition: all 0.3s ease !important;
}

.documentation-link-card:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
}

.documentation-link-card a {
  display: flex !important;
  align-items: center !important;
  padding: 20px !important;
  text-decoration: none !important;
  color: inherit !important;
}

.doc-icon {
  font-size: 32px !important;
  margin-right: 16px !important;
  width: 48px !important;
  height: 48px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background: #f3f4f6 !important;
  border-radius: 8px !important;
}

.doc-content {
  flex: 1 !important;
}

.doc-title {
  display: block !important;
  font-size: 18px !important;
  font-weight: 600 !important;
  color: #1f2937 !important;
  margin-bottom: 4px !important;
}

.doc-subtitle {
  display: block !important;
  font-size: 14px !important;
  color: #6b7280 !important;
}

/* Compatible Container Enhanced Styles */
.compatible-container {
  margin: 20px 0 !important;
  padding: 24px !important;
  background: #f8f9fa !important;
  border-radius: 12px !important;
  border: 1px solid #e5e7eb !important;
}

.compatible-items-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
  gap: 16px !important;
  margin-top: 20px !important;
}

.compatible-item {
  display: flex !important;
  align-items: center !important;
  padding: 20px !important;
  background: white !important;
  border: 1px solid #e5e7eb !important;
  border-radius: 12px !important;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
  transition: all 0.3s ease !important;
}

.compatible-item:hover {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
  transform: translateY(-2px) !important;
}

.compatible-item img {
  width: 80px !important;
  height: 80px !important;
  object-fit: contain !important;
  background: #f9fafb !important;
  border-radius: 8px !important;
  margin-right: 16px !important;
  border: 1px solid #e5e7eb !important;
  padding: 8px !important;
}

.compatible-item-content {
  flex: 1 !important;
}

.compatible-item-title {
  color: #2563eb !important;
  font-weight: 600 !important;
  font-size: 16px !important;
  line-height: 1.3 !important;
  margin-bottom: 8px !important;
  display: block !important;
}

.compatible-item-description {
  color: #6b7280 !important;
  font-size: 14px !important;
  margin-bottom: 8px !important;
}

.compatible-item-link {
  color: #2563eb !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  text-decoration: none !important;
  border: 1px solid #2563eb !important;
  padding: 6px 12px !important;
  border-radius: 6px !important;
  display: inline-block !important;
  transition: all 0.2s ease !important;
}

.compatible-item-link:hover {
  background: #2563eb !important;
  color: white !important;
}

/* Tables */
table {
  width: 100% !important;
  border-collapse: collapse !important;
  margin: 16px 0 !important;
  border-radius: 8px !important;
  overflow: hidden !important;
  border: 1px solid #e5e7eb !important;
}

table td {
  padding: 12px 16px !important;
  border-bottom: 1px solid #e5e7eb !important;
  font-size: 14px !important;
}

table tr:first-child td {
  background: #f3f4f6 !important;
  font-weight: 600 !important;
  color: #374151 !important;
}

table tr:nth-child(even) {
  background: #f9fafb !important;
}

/* Lists */
ul {
  margin: 16px 0 !important;
  padding-left: 20px !important;
}

ul li {
  margin: 8px 0 !important;
  color: #374151 !important;
  line-height: 1.6 !important;
}

/* Headings */
h2, h3, h4 {
  color: #1f2937 !important;
  margin: 24px 0 16px 0 !important;
  font-weight: 600 !important;
}

h2 {
  font-size: 24px !important;
  border-bottom: 2px solid #e5e7eb !important;
  padding-bottom: 8px !important;
}

h3 {
  font-size: 20px !important;
}

h4 {
  font-size: 18px !important;
}

/* Paragraphs */
p {
  margin: 12px 0 !important;
  color: #374151 !important;
  line-height: 1.6 !important;
}

/* Responsive */
@media (max-width: 768px) {
  .halo-tab-nav {
    flex-direction: column !important;
  }
  
  .halo-tab-button {
    width: 100% !important;
    text-align: center !important;
  }
  
  .youtube-brand-header {
    flex-direction: column !important;
    text-align: center !important;
  }
  
  .compatible-items-grid {
    grid-template-columns: 1fr !important;
  }
  
  .compatible-item {
    flex-direction: column !important;
    text-align: center !important;
  }
  
  .compatible-item img {
    margin-right: 0 !important;
    margin-bottom: 12px !important;
  }
  
  .logo-grid {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
  }
}
</style>

<!-- YouTube Subscribe API Script - Fixed Script Loading -->
<script src="https://apis.google.com/js/platform.js" async defer></script>

<div class="halo-product-tabs-container">
  <!-- Dynamic Tab Navigation -->
  <div class="halo-tab-nav" id="halo-tab-nav">
    <!-- Tab buttons will be dynamically generated by JavaScript -->
  </div>

  <!-- Tab Content Container -->
  <div class="halo-tab-content-container">
    <div id="halo-description" class="halo-tab-content active">
      <!-- Description content will be populated by JavaScript -->
    </div>
    <div id="halo-features" class="halo-tab-content">
      <!-- Features content will be populated by JavaScript -->
    </div>
    <div id="halo-applications" class="halo-tab-content">
      <!-- Applications content will be populated by JavaScript -->
    </div>
    <div id="halo-specification" class="halo-tab-content">
      <!-- Specifications content will be populated by JavaScript -->
    </div>
    <div id="halo-videos" class="halo-tab-content">
      <!-- Videos content will be populated by JavaScript -->
    </div>
    <div id="halo-documentation" class="halo-tab-content">
      <!-- Documentation content will be populated by JavaScript -->
    </div>
    <div id="halo-sku-nomenclature" class="halo-tab-content">
      <!-- SKU Nomenclature content will be populated by JavaScript -->
    </div>
    <div id="halo-safety-guidelines" class="halo-tab-content">
      <!-- Safety Guidelines content will be populated by JavaScript -->
    </div>
    <div id="halo-compatible-container" class="halo-tab-content">
      <!-- Compatible Container content will be populated by JavaScript -->
    </div>
    <div id="halo-sterilization-method" class="halo-tab-content">
      <!-- Sterilization Method content will be populated by JavaScript -->
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get the product description HTML
  var productDescription = document.querySelector('.product-description');
  if (!productDescription) {
    productDescription = document.querySelector('[data-product-description]');
  }
  if (!productDescription) {
    // Fallback: look for the actual description content
    productDescription = document.querySelector('.container[data-sku]');
  }
  
  if (!productDescription) {
    console.log('No product description found for tab parsing');
    return;
  }

  var descriptionHTML = productDescription.innerHTML;
  
  // Check if this contains our tab structure
  if (!descriptionHTML.includes('tab-content') || !descriptionHTML.includes('data-sku')) {
    console.log('Product description does not contain tab structure');
    return;
  }

  console.log('Parsing product description for tabs...');

  // Tab configuration with improved ordering and titles
  var tabConfig = {
    'description': { title: 'Description', order: 1 },
    'features': { title: 'Features', order: 2 },
    'applications': { title: 'Applications', order: 3 },
    'sku-nomenclature': { title: 'SKU Nomenclature', order: 4 },
    'safety-guidelines': { title: 'Safety Guidelines', order: 5 },
    'compatible-container': { title: 'Compatible Container', order: 6 },
    'sterilization-method': { title: 'Sterilization Method', order: 7 },
    'specification': { title: 'Specifications', order: 8 },
    'documentation': { title: 'Documentation', order: 9 },
    'videos': { title: 'Videos', order: 10 }
  };

  var foundTabs = [];
  var tabNav = document.getElementById('halo-tab-nav');

  // Scan for available tabs in the description
  Object.keys(tabConfig).forEach(function(tabId) {
    var tabElement = descriptionHTML.match(new RegExp('<div[^>]*id="' + tabId + '"[^>]*>', 'i'));
    if (tabElement) {
      // Extract the content for this tab
      var startIndex = descriptionHTML.indexOf(tabElement[0]);
      var endIndex = findClosingDiv(descriptionHTML, startIndex);
      
      if (endIndex > startIndex) {
        var tabContent = descriptionHTML.substring(startIndex, endIndex + 6); // +6 for </div>
        
        // Check if tab has meaningful content (not just empty divs)
        var contentWithoutTags = tabContent.replace(/<[^>]*>/g, '').trim();
        if (contentWithoutTags.length > 10) { // Minimum content check
          foundTabs.push({
            id: tabId,
            title: tabConfig[tabId].title,
            order: tabConfig[tabId].order,
            content: tabContent
          });
        }
      }
    }
  });

  // Sort tabs by order
  foundTabs.sort(function(a, b) { return a.order - b.order; });

  console.log('Found tabs:', foundTabs.map(function(t) { return t.title; }));

  if (foundTabs.length === 0) {
    console.log('No valid tabs found in description');
    return;
  }

  // Create tab navigation buttons
  foundTabs.forEach(function(tab, index) {
    var button = document.createElement('button');
    button.className = 'halo-tab-button' + (index === 0 ? ' active' : '');
    button.textContent = tab.title;
    button.setAttribute('data-tab', tab.id);
    button.addEventListener('click', function() {
      switchTab(tab.id);
    });
    tabNav.appendChild(button);
  });

  // Populate tab content
  foundTabs.forEach(function(tab, index) {
    var contentDiv = document.getElementById('halo-' + tab.id);
    if (contentDiv) {
      // Extract inner content (remove the outer div wrapper)
      var innerContent = tab.content.replace(/^<div[^>]*>/, '').replace(/<\/div>$/, '');
      contentDiv.innerHTML = innerContent;
      
      if (index === 0) {
        contentDiv.classList.add('active');
      } else {
        contentDiv.classList.remove('active');
      }
    }
  });

  // Initialize YouTube API after content is loaded
  setTimeout(function() {
    if (window.gapi && window.gapi.load) {
      window.gapi.load('platform', function() {
        console.log('YouTube Platform API loaded');
      });
    }
  }, 1000);

  // Tab switching function
  function switchTab(tabId) {
    // Update button states
    var buttons = document.querySelectorAll('.halo-tab-button');
    buttons.forEach(function(btn) {
      btn.classList.remove('active');
    });
    document.querySelector('[data-tab="' + tabId + '"]').classList.add('active');

    // Update content visibility
    var contents = document.querySelectorAll('.halo-tab-content');
    contents.forEach(function(content) {
      content.classList.remove('active');
    });
    document.getElementById('halo-' + tabId).classList.add('active');

    // Re-render YouTube subscribe buttons if videos tab is active
    if (tabId === 'videos') {
      setTimeout(function() {
        if (window.gapi && window.gapi.ytsubscribe && window.gapi.ytsubscribe.render) {
          var subscribeElements = document.querySelectorAll('.g-ytsubscribe');
          subscribeElements.forEach(function(element) {
            window.gapi.ytsubscribe.render(element);
          });
        }
      }, 500);
    }
  }

  // Helper function to find the closing div tag
  function findClosingDiv(html, startIndex) {
    var depth = 0;
    var pos = startIndex;
    
    while (pos < html.length) {
      var openDiv = html.indexOf('<div', pos);
      var closeDiv = html.indexOf('</div>', pos);
      
      if (closeDiv === -1) break;
      
      if (openDiv !== -1 && openDiv < closeDiv) {
        depth++;
        pos = openDiv + 4;
      } else {
        if (depth === 0) {
          return closeDiv;
        }
        depth--;
        pos = closeDiv + 6;
      }
    }
    
    return -1;
  }

  console.log('Halo Product Tabs initialized successfully');
});
</script>